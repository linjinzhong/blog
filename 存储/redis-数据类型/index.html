<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"jesonlin.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.13.2","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Redis 提供了丰富的数据类型，常见的有五种：String（字符串）、List（列表）、Hash（哈希）、Set（集合）、Zset（有序集合）。">
<meta property="og:type" content="article">
<meta property="og:title" content="redis-数据类型">
<meta property="og:url" content="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/index.html">
<meta property="og:site_name" content="jesonlin">
<meta property="og:description" content="Redis 提供了丰富的数据类型，常见的有五种：String（字符串）、List（列表）、Hash（哈希）、Set（集合）、Zset（有序集合）。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.webp">
<meta property="og:image" content="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/string%E7%BB%93%E6%9E%84.webp">
<meta property="og:image" content="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/int.webp">
<meta property="og:image" content="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/embstr.webp">
<meta property="og:image" content="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/raw.webp">
<meta property="og:image" content="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/Session2.webp">
<meta property="og:image" content="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/quicklist.webp">
<meta property="og:image" content="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/list.webp">
<meta property="og:image" content="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97.webp">
<meta property="og:image" content="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/%E8%B4%AD%E7%89%A9%E8%BD%A6.webp">
<meta property="og:image" content="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/zset.webp">
<meta property="article:published_time" content="2022-12-12T09:11:51.000Z">
<meta property="article:modified_time" content="2023-05-22T13:41:20.025Z">
<meta property="article:author" content="jesonlin">
<meta property="article:tag" content="redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.webp">


<link rel="canonical" href="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/","path":"存储/redis-数据类型/","title":"redis-数据类型"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>redis-数据类型 | jesonlin</title>
  






  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">jesonlin</p>
      <i class="logo-line"></i>
    </a>
      <img class="custom-logo-image" src="/images/qq-image.jpeg" alt="jesonlin">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-resources"><a href="/resources/" rel="section"><i class="fa fa-download fa-fw"></i>resources</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%AF%B9%E5%BA%94%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text">Redis 数据类型对应数据结构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#String%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89"><span class="nav-number">2.</span> <span class="nav-text">String（字符串）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.2.</span> <span class="nav-text">内部实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">2.3.</span> <span class="nav-text">常用命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">2.3.1.</span> <span class="nav-text">普通字符串基本操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E8%AE%BE%E7%BD%AE"><span class="nav-number">2.3.2.</span> <span class="nav-text">批量设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E6%95%B0%E5%99%A8%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%86%85%E5%AE%B9%E4%B8%BA%E6%95%B4%E6%95%B0%E7%9A%84%E6%97%B6%E5%80%99%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%EF%BC%89%EF%BC%9A"><span class="nav-number">2.3.3.</span> <span class="nav-text">计数器（字符串的内容为整数的时候可以使用）：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%9C%9F%EF%BC%88%E9%BB%98%E8%AE%A4%E4%B8%BA%E6%B0%B8%E4%B8%8D%E8%BF%87%E6%9C%9F%EF%BC%89%EF%BC%9A"><span class="nav-number">2.3.4.</span> <span class="nav-text">过期（默认为永不过期）：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8D%E5%AD%98%E5%9C%A8%E5%B0%B1%E6%8F%92%E5%85%A5%EF%BC%9A"><span class="nav-number">2.3.5.</span> <span class="nav-text">不存在就插入：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">2.4.</span> <span class="nav-text">应用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E5%AF%B9%E8%B1%A1"><span class="nav-number">2.4.1.</span> <span class="nav-text">缓存对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%84%E8%AE%A1%E6%95%B0"><span class="nav-number">2.4.2.</span> <span class="nav-text">常规计数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="nav-number">2.4.3.</span> <span class="nav-text">分布式锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B1%E4%BA%AB-Session-%E4%BF%A1%E6%81%AF"><span class="nav-number">2.4.4.</span> <span class="nav-text">共享 Session 信息</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#List%EF%BC%88%E5%88%97%E8%A1%A8%EF%BC%89"><span class="nav-number">3.</span> <span class="nav-text">List（列表）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="nav-number">3.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0-1"><span class="nav-number">3.2.</span> <span class="nav-text">内部实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-1"><span class="nav-number">3.3.</span> <span class="nav-text">常用命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-1"><span class="nav-number">3.4.</span> <span class="nav-text">应用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="nav-number">3.4.1.</span> <span class="nav-text">消息队列</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Hash%EF%BC%88%E5%93%88%E5%B8%8C%EF%BC%89"><span class="nav-number">4.</span> <span class="nav-text">Hash（哈希）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="nav-number">4.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0-2"><span class="nav-number">4.2.</span> <span class="nav-text">内部实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-2"><span class="nav-number">4.3.</span> <span class="nav-text">常用命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-2"><span class="nav-number">4.4.</span> <span class="nav-text">应用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E5%AF%B9%E8%B1%A1-1"><span class="nav-number">4.4.1.</span> <span class="nav-text">缓存对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="nav-number">4.4.2.</span> <span class="nav-text">购物车</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Set%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89"><span class="nav-number">5.</span> <span class="nav-text">Set（集合）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D-3"><span class="nav-number">5.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0-3"><span class="nav-number">5.2.</span> <span class="nav-text">内部实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-3"><span class="nav-number">5.3.</span> <span class="nav-text">常用命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-3"><span class="nav-number">5.4.</span> <span class="nav-text">应用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E8%B5%9E"><span class="nav-number">5.4.1.</span> <span class="nav-text">点赞</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B1%E5%90%8C%E5%85%B3%E6%B3%A8"><span class="nav-number">5.4.2.</span> <span class="nav-text">共同关注</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%BD%E5%A5%96%E6%B4%BB%E5%8A%A8"><span class="nav-number">5.4.3.</span> <span class="nav-text">抽奖活动</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Zset%EF%BC%88%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%EF%BC%89"><span class="nav-number">6.</span> <span class="nav-text">Zset（有序集合）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D-4"><span class="nav-number">6.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0-4"><span class="nav-number">6.2.</span> <span class="nav-text">内部实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-4"><span class="nav-number">6.3.</span> <span class="nav-text">常用命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-4"><span class="nav-number">6.4.</span> <span class="nav-text">应用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%92%E8%A1%8C%E6%A6%9C"><span class="nav-number">6.4.1.</span> <span class="nav-text">排行榜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%B5%E8%AF%9D%E3%80%81%E5%A7%93%E5%90%8D%E6%8E%92%E5%BA%8F"><span class="nav-number">6.4.2.</span> <span class="nav-text">电话、姓名排序</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reference"><span class="nav-number">7.</span> <span class="nav-text">Reference</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="jesonlin"
      src="/images/handsome.jpg">
  <p class="site-author-name" itemprop="name">jesonlin</p>
  <div class="site-description" itemprop="description">choice is better than effort</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">31</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/linjinzhong" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;linjinzhong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:jesonlin@outlook.com" title="E-Mail → mailto:jesonlin@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/jesonlinjz" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;jesonlinjz" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/jesonlinjz" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;jesonlinjz" rel="noopener" target="_blank"><i class="fab fa-facebook fa-fw"></i>FB Page</a>
      </span>
  </div>


<!-- CloudCalendar -->
<div class="widget-wrap" style="width: 90%;margin-left: auto;margin-right: auto; opacity: 0.97;">
	<div class="widget" id="CloudCalendar"></div>
</div>
        </div>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">
 

      

  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/handsome.jpg">
      <meta itemprop="name" content="jesonlin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jesonlin">
      <meta itemprop="description" content="choice is better than effort">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="redis-数据类型 | jesonlin">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          redis-数据类型
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-12-12 17:11:51" itemprop="dateCreated datePublished" datetime="2022-12-12T17:11:51+08:00">2022-12-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-22 21:41:20" itemprop="dateModified" datetime="2023-05-22T21:41:20+08:00">2023-05-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">存储</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>12k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>11 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Redis 提供了丰富的数据类型，常见的有五种：<br>String（字符串）、List（列表）、Hash（哈希）、Set（集合）、Zset（有序集合）。</p>
<span id="more"></span>
<h1 id="Redis-数据类型对应数据结构"><a href="#Redis-数据类型对应数据结构" class="headerlink" title="Redis 数据类型对应数据结构"></a>Redis 数据类型对应数据结构</h1><img src="./redis数据类型与数据结构.webp" width = "50%" height = "50%" alt="redis数据类型与数据结构" align=center />

<h1 id="String（字符串）"><a href="#String（字符串）" class="headerlink" title="String（字符串）"></a>String（字符串）</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>String 是最基本的 key-value 结构，，key 是唯一标识，value 是具体的值，value其实不仅是字符串， 也可以是数字（整数或浮点数），value 最多可以容纳的数据长度是 512M。</p>
<h2 id="内部实现"><a href="#内部实现" class="headerlink" title="内部实现"></a>内部实现</h2><p>String 类型的底层的数据结构实现主要是 int 和 SDS（简单动态字符串）。</p>
<p>SDS 相比于 C 的原生字符串：</p>
<pre><code>SDS 不仅可以保存文本数据，还可以保存二进制数据。因为 SDS 使用 len 属性的值而不是空字符来判断字符串是否结束

SDS 获取字符串长度的时间复杂度是 O(1)。因为 C 语言的字符串并不记录自身长度，所以获取长度的复杂度为 O(n)；而 SDS 结构里用 len 属性记录了字符串长度，所以复杂度为 O(1)。

Redis 的 SDS API 是安全的，拼接字符串不会造成缓冲区溢出。因为 SDS 在拼接字符串之前会检查 SDS 空间是否满足要求，如果空间不够会自动扩容，所以不会导致缓冲区溢出的问题。
</code></pre>
<p>字符串对象的内部编码（encoding）有 3 种 ：int、raw和 embstr。<br>    <img src="./string结构.webp" width = "50%" height = "50%" alt="string结构" align=center /></p>
<p>整数值可以用long类型来表示<br>    <img src="./int.webp" width = "50%" height = "50%" alt="int" align=center /></p>
<p>字符申的长度小于等于 44 字节，一次内存分配函数来分配一块连续的内存空间来保存redisObject和SDS，所有数据都保存在一块连续的内存里面可以更好的利用 CPU 缓存提升性能。<br>    <img src="./embstr.webp" width = "50%" height = "50%" alt="embstr" align=center /></p>
<p>字符申的长度大于 44 字节，调用两次内存分配函数来分别分配两块空间来保存redisObject和SDS。<br>    <img src="./raw.webp" width = "50%" height = "50%" alt="raw" align=center /></p>
<p> embstr 字符串长度增加需要重新分配内存时，整个redisObject和sds都需要重新分配空间，所以embstr编码的字符串对象实际上是只读的。对embstr编码的字符串对象执行任何修改命令（例如append）时，程序会先将对象的编码从embstr转换成raw，然后再执行修改命令。</p>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="普通字符串基本操作"><a href="#普通字符串基本操作" class="headerlink" title="普通字符串基本操作"></a>普通字符串基本操作</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 设置 key<span class="operator">-</span><span class="keyword">value</span> 类型的值</span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">SET</span> name lin</span><br><span class="line">OK</span><br><span class="line"># 根据 key 获得对应的 <span class="keyword">value</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">GET</span> name</span><br><span class="line">&quot;lin&quot;</span><br><span class="line"># 判断某个 key 是否存在</span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">EXISTS</span> name</span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"># 返回 key 所储存的字符串值的长度</span><br><span class="line"><span class="operator">&gt;</span> STRLEN name</span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"># 删除某个 key 对应的值</span><br><span class="line"><span class="operator">&gt;</span> DEL name</span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="批量设置"><a href="#批量设置" class="headerlink" title="批量设置"></a>批量设置</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 批量设置 key<span class="operator">-</span><span class="keyword">value</span> 类型的值</span><br><span class="line"><span class="operator">&gt;</span> MSET key1 value1 key2 value2 </span><br><span class="line">OK</span><br><span class="line"># 批量获取多个 key 对应的 <span class="keyword">value</span></span><br><span class="line"><span class="operator">&gt;</span> MGET key1 key2 </span><br><span class="line"><span class="number">1</span>) &quot;value1&quot;</span><br><span class="line"><span class="number">2</span>) &quot;value2&quot;</span><br></pre></td></tr></table></figure>

<h3 id="计数器（字符串的内容为整数的时候可以使用）："><a href="#计数器（字符串的内容为整数的时候可以使用）：" class="headerlink" title="计数器（字符串的内容为整数的时候可以使用）："></a>计数器（字符串的内容为整数的时候可以使用）：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 设置 key<span class="operator">-</span><span class="keyword">value</span> 类型的值</span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">SET</span> number <span class="number">0</span></span><br><span class="line">OK</span><br><span class="line"># 将 key 中储存的数字值增一</span><br><span class="line"><span class="operator">&gt;</span> INCR number</span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"># 将key中存储的数字值加 <span class="number">10</span></span><br><span class="line"><span class="operator">&gt;</span> INCRBY number <span class="number">10</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">11</span></span><br><span class="line"># 将 key 中储存的数字值减一</span><br><span class="line"><span class="operator">&gt;</span> DECR number</span><br><span class="line">(<span class="type">integer</span>) <span class="number">10</span></span><br><span class="line"># 将key中存储的数字值键 <span class="number">10</span></span><br><span class="line"><span class="operator">&gt;</span> DECRBY number <span class="number">10</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="过期（默认为永不过期）："><a href="#过期（默认为永不过期）：" class="headerlink" title="过期（默认为永不过期）："></a>过期（默认为永不过期）：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 设置 key 在 <span class="number">60</span> 秒后过期（该方法是针对已经存在的key设置过期时间）</span><br><span class="line"><span class="operator">&gt;</span> EXPIRE name  <span class="number">60</span> </span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"># 查看数据还有多久过期</span><br><span class="line"><span class="operator">&gt;</span> TTL name </span><br><span class="line">(<span class="type">integer</span>) <span class="number">51</span></span><br><span class="line"></span><br><span class="line">#设置 key<span class="operator">-</span><span class="keyword">value</span> 类型的值，并设置该key的过期时间为 <span class="number">60</span> 秒</span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">SET</span> key  <span class="keyword">value</span> EX <span class="number">60</span></span><br><span class="line">OK</span><br><span class="line"><span class="operator">&gt;</span> SETEX key  <span class="number">60</span> <span class="keyword">value</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<h3 id="不存在就插入："><a href="#不存在就插入：" class="headerlink" title="不存在就插入："></a>不存在就插入：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 不存在就插入（<span class="keyword">not</span> <span class="keyword">exists</span>）</span><br><span class="line"><span class="operator">&gt;</span>SETNX key <span class="keyword">value</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><h3 id="缓存对象"><a href="#缓存对象" class="headerlink" title="缓存对象"></a>缓存对象</h3><p>缓存整个对象的 JSON</p>
<pre><code>SET user:1 &#39;&#123;&quot;name&quot;:&quot;xiaolin&quot;, &quot;age&quot;:18&#125;&#39;
</code></pre>
<p>将 key 进行分离为 user:ID:属性</p>
<pre><code>MSET user:1:name xiaolin user:1:age 18 user:2:name xiaomei user:2:age 20
</code></pre>
<h3 id="常规计数"><a href="#常规计数" class="headerlink" title="常规计数"></a>常规计数</h3><p>因为 Redis 处理命令是单线程，所以执行命令的过程是原子的。因此 String 数据类型适合计数场景，比如计算访问次数、点赞、转发、库存数量等等。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 初始化文章的阅读量</span><br><span class="line">&gt; SET aritcle:readcount:1001 0</span><br><span class="line">OK</span><br><span class="line">#阅读量+1</span><br><span class="line">&gt; INCR aritcle:readcount:1001</span><br><span class="line">(integer) 1</span><br><span class="line">#阅读量+1</span><br><span class="line"># 获取对应文章的阅读量</span><br><span class="line">&gt; GET aritcle:readcount:1001</span><br><span class="line">&quot;1&quot;</span><br></pre></td></tr></table></figure>

<h3 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h3><p>SET 命令有个 NX 参数可以实现「key不存在才插入」，可以用它来实现分布式锁：</p>
<pre><code>1. 如果 key 不存在，则显示插入成功，可以用来表示加锁成功；
2. 如果 key 存在，则会显示插入失败，可以用来表示加锁失败。
</code></pre>
<p>一般而言，还会对分布式锁加上过期时间，分布式锁的命令如下：</p>
<pre><code>SET lock_key unique_value NX PX 10000

lock_key 就是 key 键；
unique_value 是客户端生成的唯一的标识；
NX 代表只在 lock_key 不存在时，才对 lock_key 进行设置操作；
PX 10000 表示设置 lock_key 的过期时间为 10s，这是为了避免客户端发生异常而无法释放锁
</code></pre>
<p>解锁的过程就是将 lock_key 键删除，但不能乱删，要保证执行操作的客户端就是加锁的客户端。</p>
<pre><code>// 释放锁时，先比较 unique_value 是否相等，避免锁的误释放
if redis.call(&quot;get&quot;,KEYS[1]) == ARGV[1] then
    return redis.call(&quot;del&quot;,KEYS[1])
else
    return 0
end
</code></pre>
<h3 id="共享-Session-信息"><a href="#共享-Session-信息" class="headerlink" title="共享 Session 信息"></a>共享 Session 信息</h3><p>开发后台管理系统时，会使用 Session 来保存用户的会话(登录)状态，这些 Session 信息会被保存在服务器端，但这只适用于单系统应用，如果是分布式系统此模式将不再适用。</p>
<p>借助 Redis 对这些 Session 信息进行统一的存储和管理，这样无论请求发送到那台服务器，服务器都会去同一个 Redis 获取相关的 Session 信息<br><img src="./Session2.webp" width = "50%" height = "50%" alt="Session2" align=center /></p>
<h1 id="List（列表）"><a href="#List（列表）" class="headerlink" title="List（列表）"></a>List（列表）</h1><h2 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h2><p>List 列表是简单的字符串列表，按照插入顺序排序，可以从头部或尾部向 List 列表添加元素。</p>
<p>列表的最大长度为 2^32 - 1，也即每个列表支持超过 40 亿个元素。</p>
<h2 id="内部实现-1"><a href="#内部实现-1" class="headerlink" title="内部实现"></a>内部实现</h2><p>List 类型的底层数据结构是由双向链表或压缩列表实现的：</p>
<pre><code>1. 如果列表的元素个数小于 512 个（默认值，可由 list-max-ziplist-entries 配置），列表每个元素的值都小于 64 字节（默认值，可由 list-max-ziplist-value 配置），Redis 会使用ziplist（压缩列表）作为 List 类型的底层数据结构；连续内存空间，存储效率高，不利于修改操作，插入和删除操作需要频繁申请和释放内存。


2. 如果列表的元素不满足上面的条件，Redis 会使用双向链表作为 List 类型的底层数据结构，前后指针浪费16字节。其次，双向链表的各个节点是单独的内存块，地址不连续，节点多了容易产生内存碎片。
</code></pre>
<p>但是在 Redis 3.2 版本之后，List 数据类型底层数据结构就只由 quicklist 实现了，替代了双向链表和压缩列表。</p>
<img src="./quicklist.webp" width = "50%" height = "50%" alt="quicklist" align=center />

<h2 id="常用命令-1"><a href="#常用命令-1" class="headerlink" title="常用命令"></a>常用命令</h2><img src="./list.webp" width = "50%" height = "50%" alt="list" align=center />

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 将一个或多个值<span class="keyword">value</span>插入到key列表的表头(最左边)，最后的值在最前面</span><br><span class="line">LPUSH key <span class="keyword">value</span> [<span class="keyword">value</span> ...] </span><br><span class="line"># 将一个或多个值<span class="keyword">value</span>插入到key列表的表尾(最右边)</span><br><span class="line">RPUSH key <span class="keyword">value</span> [<span class="keyword">value</span> ...]</span><br><span class="line"># 移除并返回key列表的头元素</span><br><span class="line">LPOP key     </span><br><span class="line"># 移除并返回key列表的尾元素</span><br><span class="line">RPOP key </span><br><span class="line"></span><br><span class="line"># 返回列表key中指定区间内的元素，区间以偏移量<span class="keyword">start</span>和stop指定，从<span class="number">0</span>开始</span><br><span class="line">LRANGE key <span class="keyword">start</span> stop</span><br><span class="line"></span><br><span class="line"># 从key列表表头弹出一个元素，没有就阻塞timeout秒，如果timeout<span class="operator">=</span><span class="number">0</span>则一直阻塞</span><br><span class="line">BLPOP key [key ...] timeout</span><br><span class="line"># 从key列表表尾弹出一个元素，没有就阻塞timeout秒，如果timeout<span class="operator">=</span><span class="number">0</span>则一直阻塞</span><br><span class="line">BRPOP key [key ...] timeout</span><br></pre></td></tr></table></figure>

<h2 id="应用场景-1"><a href="#应用场景-1" class="headerlink" title="应用场景"></a>应用场景</h2><h3 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h3><p>消息队列在存取消息时，必须要满足三个需求，分别是消息保序、处理重复的消息和保证消息可靠性。</p>
<pre><code>消息保序：使用 LPUSH + RPOP；
阻塞读取：使用 BRPOP；
重复消息处理：生产者自行实现全局唯一 ID；
消息的可靠性：使用 BRPOPLPUSH
</code></pre>
<ol>
<li><p>如何满足消息保序需求？</p>
<p> List 可以使用 LPUSH + RPOP （或者反过来，RPUSH+LPOP）命令实现消息队列。</p>
<p> Redis提供了 BRPOP 命令。BRPOP命令也称为阻塞式读取，客户端在没有读到队列数据时，自动阻塞，直到有新的数据写入队列，再开始读取新数据。</p>
</li>
</ol>
<img src="./消息队列.webp" width = "50%" height = "50%" alt="消息队列" align=center />

<ol start="2">
<li><p>如何处理重复的消息？</p>
<p> 每个消息都有一个全局的 ID。</p>
<p> 消费者要记录已经处理过的消息的 ID。当收到一条消息后，消费者程序就可以对比收到的消息 ID 和记录的已处理过的消息 ID，来判断当前收到的消息有没有经过处理。</p>
<p> 但是 List 并不会为每个消息生成 ID 号，所以我们需要自行为每个消息生成一个全局唯一ID，生成之后，我们在用 LPUSH 命令把消息插入 List 时，需要在消息中包含这个全局唯一 ID</p>
</li>
<li><p>如何保证消息可靠性？</p>
<p> 如果消费者程序在处理消息的过程出现了故障或宕机，就会导致消息没有处理完成，那么，消费者程序再次启动后，就没法再次从 List 中读取消息了。</p>
<p> 为了留存消息，List 类型提供了 BRPOPLPUSH 命令，这个命令的作用是让消费者程序从一个 List 中读取消息，同时，Redis 会把这个消息再插入到另一个 List（可以叫作备份 List）留存。</p>
</li>
</ol>
<p>List 作为消息队列有什么缺陷？<br>    List 不支持多个消费者消费同一条消息，因为一旦消费者拉取一条消息后，这条消息就从 List 中删除了，无法被其它消费者再次消费</p>
<h1 id="Hash（哈希）"><a href="#Hash（哈希）" class="headerlink" title="Hash（哈希）"></a>Hash（哈希）</h1><h2 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h2><p>Hash 是一个键值对（key - value）集合。Hash 特别适合用于存储对象。</p>
<h2 id="内部实现-2"><a href="#内部实现-2" class="headerlink" title="内部实现"></a>内部实现</h2><p>Hash 类型的底层数据结构是由压缩列表或哈希表实现的：</p>
<pre><code>1. 如果哈希类型元素个数小于 512 个（默认值，可由 hash-max-ziplist-entries 配置），所有值小于 64 字节（默认值，可由 hash-max-ziplist-value 配置）的话，Redis 会使用压缩列表作为 Hash 类型的底层数据结构；

2. 如果哈希类型元素不满足上面条件，Redis 会使用哈希表作为 Hash 类型的 底层数据结构。

3. 在 Redis 7.0 中，压缩列表数据结构已经废弃了，交由 listpack 数据结构来实现了。
</code></pre>
<h2 id="常用命令-2"><a href="#常用命令-2" class="headerlink" title="常用命令"></a>常用命令</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 存储一个哈希表key的键值</span><br><span class="line">HSET key field <span class="keyword">value</span>   </span><br><span class="line"># 获取哈希表key对应的field键值</span><br><span class="line">HGET key field</span><br><span class="line"></span><br><span class="line"># 在一个哈希表key中存储多个键值对</span><br><span class="line">HMSET key field <span class="keyword">value</span> [field value...] </span><br><span class="line"># 批量获取哈希表key中多个field键值</span><br><span class="line">HMGET key field [field ...]       </span><br><span class="line"># 删除哈希表key中的field键值</span><br><span class="line">HDEL key field [field ...]    </span><br><span class="line"></span><br><span class="line"># 返回哈希表key中field的数量</span><br><span class="line">HLEN key       </span><br><span class="line"># 返回哈希表key中所有的键值</span><br><span class="line">HGETALL key </span><br><span class="line"></span><br><span class="line"># 为哈希表key中field键的值加上增量n</span><br><span class="line">HINCRBY key field n                         </span><br></pre></td></tr></table></figure>

<h2 id="应用场景-2"><a href="#应用场景-2" class="headerlink" title="应用场景"></a>应用场景</h2><h3 id="缓存对象-1"><a href="#缓存对象-1" class="headerlink" title="缓存对象"></a>缓存对象</h3><p>Hash 类型的 （key，field， value） 的结构与对象的（对象id， 属性， 值）的结构相似，也可以用来存储对象。</p>
<p>我们可以使用如下命令，将用户对象的信息存储到 Hash 类型：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 存储一个哈希表uid:<span class="number">1</span>的键值</span><br><span class="line"><span class="operator">&gt;</span> HMSET uid:<span class="number">1</span> name Tom age <span class="number">15</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"># 存储一个哈希表uid:<span class="number">2</span>的键值</span><br><span class="line"><span class="operator">&gt;</span> HMSET uid:<span class="number">2</span> name Jerry age <span class="number">13</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"># 获取哈希表用户id为<span class="number">1</span>中所有的键值</span><br><span class="line"><span class="operator">&gt;</span> HGETALL uid:<span class="number">1</span></span><br><span class="line"><span class="number">1</span>) &quot;name&quot;</span><br><span class="line"><span class="number">2</span>) &quot;Tom&quot;</span><br><span class="line"><span class="number">3</span>) &quot;age&quot;</span><br><span class="line"><span class="number">4</span>) &quot;15&quot;</span><br></pre></td></tr></table></figure>

<h3 id="购物车"><a href="#购物车" class="headerlink" title="购物车"></a>购物车</h3><p>以用户 id 为 key，商品 id 为 field，商品数量为 value，恰好构成了购物车的3个要素，如下图所示。</p>
<img src="./购物车.webp" width = "50%" height = "50%" alt="购物车" align=center />

<p>涉及的命令如下：</p>
<pre><code>添加商品：HSET cart:&#123;用户id&#125; &#123;商品id&#125; 1
添加数量：HINCRBY cart:&#123;用户id&#125; &#123;商品id&#125; 1
商品总数：HLEN cart:&#123;用户id&#125;
删除商品：HDEL cart:&#123;用户id&#125; &#123;商品id&#125;
获取购物车所有商品：HGETALL cart:&#123;用户id&#125;
</code></pre>
<h1 id="Set（集合）"><a href="#Set（集合）" class="headerlink" title="Set（集合）"></a>Set（集合）</h1><h2 id="介绍-3"><a href="#介绍-3" class="headerlink" title="介绍"></a>介绍</h2><p>Set 类型是一个无序并唯一的键值集合，它的存储顺序不会按照插入的先后顺序进行存储。</p>
<p>一个集合最多可以存储 2^32-1 个元素。概念和数学中个的集合基本类似，可以交集，并集，差集等等，所以 Set 类型除了支持集合内的增删改查，同时还支持多个集合取交集、并集、差集。</p>
<h2 id="内部实现-3"><a href="#内部实现-3" class="headerlink" title="内部实现"></a>内部实现</h2><p>Set 类型的底层数据结构是由哈希表或整数集合实现的：</p>
<pre><code>如果集合中的元素都是整数且元素个数小于 512 （默认值，set-maxintset-entries配置）个，Redis 会使用整数集合作为 Set 类型的底层数据结构；

如果集合中的元素不满足上面条件，则 Redis 使用哈希表作为 Set 类型的底层数据结构。
</code></pre>
<h2 id="常用命令-3"><a href="#常用命令-3" class="headerlink" title="常用命令"></a>常用命令</h2><ol>
<li>常用操作<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 往集合key中存入元素，元素存在则忽略，若key不存在则新建</span><br><span class="line">SADD key <span class="keyword">member</span> [<span class="keyword">member</span> ...]</span><br><span class="line"># 从集合key中删除元素</span><br><span class="line">SREM key <span class="keyword">member</span> [<span class="keyword">member</span> ...] </span><br><span class="line"># 获取集合key中所有元素</span><br><span class="line">SMEMBERS key</span><br><span class="line"># 获取集合key中的元素个数</span><br><span class="line">SCARD key</span><br><span class="line"></span><br><span class="line"># 判断<span class="keyword">member</span>元素是否存在于集合key中</span><br><span class="line">SISMEMBER key <span class="keyword">member</span></span><br><span class="line"></span><br><span class="line"># 从集合key中随机选出count个元素，元素不从key中删除</span><br><span class="line">SRANDMEMBER key [count]</span><br><span class="line"># 从集合key中随机选出count个元素，元素从key中删除</span><br><span class="line">SPOP key [count]</span><br></pre></td></tr></table></figure></li>
<li>运算操作<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 交集运算</span><br><span class="line">SINTER key [key ...]</span><br><span class="line"># 将交集结果存入新集合destination中</span><br><span class="line">SINTERSTORE destination key [key ...]</span><br><span class="line"></span><br><span class="line"># 并集运算</span><br><span class="line">SUNION key [key ...]</span><br><span class="line"># 将并集结果存入新集合destination中</span><br><span class="line">SUNIONSTORE destination key [key ...]</span><br><span class="line"></span><br><span class="line"># 差集运算</span><br><span class="line">SDIFF key [key ...]</span><br><span class="line"># 将差集结果存入新集合destination中</span><br><span class="line">SDIFFSTORE destination key [key ...]</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="应用场景-3"><a href="#应用场景-3" class="headerlink" title="应用场景"></a>应用场景</h2><p>集合的主要几个特性，无序、不可重复、支持并交差等操作。</p>
<p>这里有一个潜在的风险。Set 的差集、并集和交集的计算复杂度较高，在数据量较大的情况下，如果直接执行这些计算，会导致 Redis 实例阻塞。</p>
<p>在主从集群中，为了避免主库因为 Set 做聚合计算（交集、差集、并集）时导致主库被阻塞，我们可以选择一个从库完成聚合统计，或者把数据返回给客户端，由客户端来完成聚合统计</p>
<h3 id="点赞"><a href="#点赞" class="headerlink" title="点赞"></a>点赞</h3><p>Set 类型可以保证一个用户只能点一个赞，这里举例子一个场景，key 是文章id，value 是用户id。</p>
<p>uid:1 、uid:2、uid:3 三个用户分别对 article:1 文章点赞了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># uid:<span class="number">1</span> 用户对文章 article:<span class="number">1</span> 点赞</span><br><span class="line"><span class="operator">&gt;</span> SADD article:<span class="number">1</span> uid:<span class="number">1</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"># uid:<span class="number">2</span> 用户对文章 article:<span class="number">1</span> 点赞</span><br><span class="line"><span class="operator">&gt;</span> SADD article:<span class="number">1</span> uid:<span class="number">2</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"># uid:<span class="number">3</span> 用户对文章 article:<span class="number">1</span> 点赞</span><br><span class="line"><span class="operator">&gt;</span> SADD article:<span class="number">1</span> uid:<span class="number">3</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"></span><br><span class="line"># uid:<span class="number">1</span> 取消了对 article:<span class="number">1</span> 文章点赞。</span><br><span class="line"><span class="operator">&gt;</span> SREM article:<span class="number">1</span> uid:<span class="number">1</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"></span><br><span class="line"># 获取 article:<span class="number">1</span> 文章所有点赞用户 :</span><br><span class="line"><span class="operator">&gt;</span> SMEMBERS article:<span class="number">1</span></span><br><span class="line"><span class="number">1</span>) &quot;uid:3&quot;</span><br><span class="line"><span class="number">2</span>) &quot;uid:2&quot;</span><br><span class="line"></span><br><span class="line"># 判断用户 uid:<span class="number">1</span> 是否对文章 article:<span class="number">1</span> 点赞了：</span><br><span class="line"><span class="operator">&gt;</span> SISMEMBER article:<span class="number">1</span> uid:<span class="number">1</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">0</span>  # 返回<span class="number">0</span>说明没点赞，返回<span class="number">1</span>则说明点赞了</span><br></pre></td></tr></table></figure>

<h3 id="共同关注"><a href="#共同关注" class="headerlink" title="共同关注"></a>共同关注</h3><p>Set 类型支持交集运算，所以可以用来计算共同关注的好友、公众号等。</p>
<p>key 可以是用户id，value 则是已关注的公众号的id。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># uid:<span class="number">1</span> 用户关注公众号 id 为 <span class="number">5</span>、<span class="number">6</span>、<span class="number">7</span>、<span class="number">8</span>、<span class="number">9</span></span><br><span class="line"><span class="operator">&gt;</span> SADD uid:<span class="number">1</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">5</span></span><br><span class="line"># uid:<span class="number">2</span>  用户关注公众号 id 为 <span class="number">7</span>、<span class="number">8</span>、<span class="number">9</span>、<span class="number">10</span>、<span class="number">11</span></span><br><span class="line"><span class="operator">&gt;</span> SADD uid:<span class="number">2</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">10</span> <span class="number">11</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">5</span></span><br><span class="line"></span><br><span class="line"># uid:<span class="number">1</span> 和 uid:<span class="number">2</span> 共同关注的公众号：</span><br><span class="line"># 获取共同关注</span><br><span class="line"><span class="operator">&gt;</span> SINTER uid:<span class="number">1</span> uid:<span class="number">2</span></span><br><span class="line"><span class="number">1</span>) &quot;7&quot;</span><br><span class="line"><span class="number">2</span>) &quot;8&quot;</span><br><span class="line"><span class="number">3</span>) &quot;9&quot;</span><br><span class="line"></span><br><span class="line"># 给 uid:<span class="number">2</span> 推荐 uid:<span class="number">1</span> 关注的公众号：</span><br><span class="line"><span class="operator">&gt;</span> SDIFF uid:<span class="number">1</span> uid:<span class="number">2</span></span><br><span class="line"><span class="number">1</span>) &quot;5&quot;</span><br><span class="line"><span class="number">2</span>) &quot;6&quot;</span><br><span class="line"></span><br><span class="line"># 验证某个公众号是否同时被 uid:<span class="number">1</span> 或 uid:<span class="number">2</span> 关注:</span><br><span class="line"><span class="operator">&gt;</span> SISMEMBER uid:<span class="number">1</span> <span class="number">5</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span> # 返回<span class="number">0</span>，说明关注了</span><br><span class="line"><span class="operator">&gt;</span> SISMEMBER uid:<span class="number">2</span> <span class="number">5</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">0</span> # 返回<span class="number">0</span>，说明没关注</span><br></pre></td></tr></table></figure>

<h3 id="抽奖活动"><a href="#抽奖活动" class="headerlink" title="抽奖活动"></a>抽奖活动</h3><p>存储某活动中中奖的用户名 ，Set 类型因为有去重功能，可以保证同一个用户不会中奖两次。</p>
<p>key为抽奖活动名，value为员工名称，把所有员工名称放入抽奖箱 ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span>SADD lucky Tom Jerry John Sean Marry Lindy Sary Mark</span><br><span class="line">(<span class="type">integer</span>) <span class="number">5</span></span><br><span class="line"></span><br><span class="line"># 如果允许重复中奖，可以使用 SRANDMEMBER 命令。</span><br><span class="line"># 抽取 <span class="number">1</span> 个一等奖：</span><br><span class="line"><span class="operator">&gt;</span> SRANDMEMBER lucky <span class="number">1</span></span><br><span class="line"><span class="number">1</span>) &quot;Tom&quot;</span><br><span class="line"># 抽取 <span class="number">2</span> 个二等奖：</span><br><span class="line"><span class="operator">&gt;</span> SRANDMEMBER lucky <span class="number">2</span></span><br><span class="line"><span class="number">1</span>) &quot;Mark&quot;</span><br><span class="line"><span class="number">2</span>) &quot;Jerry&quot;</span><br><span class="line"># 抽取 <span class="number">3</span> 个三等奖：</span><br><span class="line"><span class="operator">&gt;</span> SRANDMEMBER lucky <span class="number">3</span></span><br><span class="line"><span class="number">1</span>) &quot;Sary&quot;</span><br><span class="line"><span class="number">2</span>) &quot;Tom&quot;</span><br><span class="line"><span class="number">3</span>) &quot;Jerry&quot;</span><br><span class="line"></span><br><span class="line"># 如果不允许重复中奖，可以使用 SPOP 命令。</span><br><span class="line"># 抽取一等奖<span class="number">1</span>个</span><br><span class="line"><span class="operator">&gt;</span> SPOP lucky <span class="number">1</span></span><br><span class="line"><span class="number">1</span>) &quot;Sary&quot;</span><br><span class="line"># 抽取二等奖<span class="number">2</span>个</span><br><span class="line"><span class="operator">&gt;</span> SPOP lucky <span class="number">2</span></span><br><span class="line"><span class="number">1</span>) &quot;Jerry&quot;</span><br><span class="line"><span class="number">2</span>) &quot;Mark&quot;</span><br><span class="line"># 抽取三等奖<span class="number">3</span>个</span><br><span class="line"><span class="operator">&gt;</span> SPOP lucky <span class="number">3</span></span><br><span class="line"><span class="number">1</span>) &quot;John&quot;</span><br><span class="line"><span class="number">2</span>) &quot;Sean&quot;</span><br><span class="line"><span class="number">3</span>) &quot;Lindy&quot;</span><br></pre></td></tr></table></figure>


<h1 id="Zset（有序集合）"><a href="#Zset（有序集合）" class="headerlink" title="Zset（有序集合）"></a>Zset（有序集合）</h1><h2 id="介绍-4"><a href="#介绍-4" class="headerlink" title="介绍"></a>介绍</h2><p>Zset 类型（有序集合类型）相比于 Set 类型多了一个排序属性 score（分值），对于有序集合 ZSet 来说，每个存储元素相当于有两个值组成的，一个是有序集合的元素值，一个是排序值。</p>
<p>有序集合保留了集合不能有重复成员的特性（分值可以重复），但不同的是，有序集合中的元素可以排序。</p>
<img src="./zset.webp" width = "50%" height = "50%" alt="zset" align=center />

<h2 id="内部实现-4"><a href="#内部实现-4" class="headerlink" title="内部实现"></a>内部实现</h2><p>Zset 类型的底层数据结构是由压缩列表或跳表实现的：</p>
<pre><code>1. 如果有序集合的元素个数小于 128 个，并且每个元素的值小于 64 字节时，Redis 会使用压缩列表作为 Zset 类型的底层数据结构；

2.如果有序集合的元素不满足上面的条件，Redis 会使用跳表作为 Zset 类型的底层数据结构；
</code></pre>
<p>在 Redis 7.0 中，压缩列表数据结构已经废弃了，交由 listpack 数据结构来实现了。</p>
<h2 id="常用命令-4"><a href="#常用命令-4" class="headerlink" title="常用命令"></a>常用命令</h2><ol>
<li><p>常用操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 往有序集合key中加入带分值元素</span><br><span class="line">ZADD key score <span class="keyword">member</span> [[score <span class="keyword">member</span>]...]   </span><br><span class="line"># 往有序集合key中删除元素</span><br><span class="line">ZREM key <span class="keyword">member</span> [member...]                 </span><br><span class="line"># 返回有序集合key中元素<span class="keyword">member</span>的分值</span><br><span class="line">ZSCORE key <span class="keyword">member</span></span><br><span class="line"># 返回有序集合key中元素个数</span><br><span class="line">ZCARD key </span><br><span class="line"></span><br><span class="line"># 为有序集合key中元素<span class="keyword">member</span>的分值加上increment</span><br><span class="line">ZINCRBY key increment <span class="keyword">member</span> </span><br><span class="line"></span><br><span class="line"># 正序获取有序集合key从<span class="keyword">start</span>下标到stop下标的元素</span><br><span class="line">ZRANGE key <span class="keyword">start</span> stop [WITHSCORES]</span><br><span class="line"># 倒序获取有序集合key从<span class="keyword">start</span>下标到stop下标的元素</span><br><span class="line">ZREVRANGE key <span class="keyword">start</span> stop [WITHSCORES]</span><br><span class="line"></span><br><span class="line"># 返回有序集合中指定分数区间内的成员，分数由低到高排序。</span><br><span class="line">ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT <span class="keyword">offset</span> count]</span><br><span class="line"></span><br><span class="line"># 返回指定成员区间内的成员，按字典正序排列, 分数必须相同。</span><br><span class="line">ZRANGEBYLEX key min max [LIMIT <span class="keyword">offset</span> count]</span><br><span class="line"># 返回指定成员区间内的成员，按字典倒序排列, 分数必须相同</span><br><span class="line">ZREVRANGEBYLEX key max min [LIMIT <span class="keyword">offset</span> count]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Zset 运算操作（相比于 Set 类型，ZSet 类型没有支持差集运算）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 并集计算(相同元素分值相加)，numberkeys一共多少个key，WEIGHTS每个key对应的分值乘积</span><br><span class="line">ZUNIONSTORE destkey numberkeys key [key...] </span><br><span class="line"># 交集计算(相同元素分值相加)，numberkeys一共多少个key，WEIGHTS每个key对应的分值乘积</span><br><span class="line">ZINTERSTORE destkey numberkeys key [key...]</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="应用场景-4"><a href="#应用场景-4" class="headerlink" title="应用场景"></a>应用场景</h2><p>Zset 类型（Sorted Set，有序集合） 可以根据元素的权重来排序，我们可以自己来决定每个元素的权重值。比如说，我们可以根据元素插入 Sorted Set 的时间确定权重值，先插入的元素权重小，后插入的元素权重大。</p>
<p>在面对需要展示最新列表、排行榜等场景时，如果数据更新频繁或者需要分页显示，可以优先考虑使用 Sorted Set。</p>
<h3 id="排行榜"><a href="#排行榜" class="headerlink" title="排行榜"></a>排行榜</h3><p>有序集合比较典型的使用场景就是排行榜。例如学生成绩的排名榜、游戏积分排行榜、视频播放排名、电商系统中商品的销量排名等。</p>
<p>我们以博文点赞排名为例，小林发表了五篇博文，分别获得赞为 200、40、100、50、150。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># arcticle:<span class="number">1</span> 文章获得了<span class="number">200</span>个赞</span><br><span class="line"><span class="operator">&gt;</span> ZADD <span class="keyword">user</span>:xiaolin:ranking <span class="number">200</span> arcticle:<span class="number">1</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"># arcticle:<span class="number">2</span> 文章获得了<span class="number">40</span>个赞</span><br><span class="line"><span class="operator">&gt;</span> ZADD <span class="keyword">user</span>:xiaolin:ranking <span class="number">40</span> arcticle:<span class="number">2</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"># arcticle:<span class="number">3</span> 文章获得了<span class="number">100</span>个赞</span><br><span class="line"><span class="operator">&gt;</span> ZADD <span class="keyword">user</span>:xiaolin:ranking <span class="number">100</span> arcticle:<span class="number">3</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"># arcticle:<span class="number">4</span> 文章获得了<span class="number">50</span>个赞</span><br><span class="line"><span class="operator">&gt;</span> ZADD <span class="keyword">user</span>:xiaolin:ranking <span class="number">50</span> arcticle:<span class="number">4</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"># arcticle:<span class="number">5</span> 文章获得了<span class="number">150</span>个赞</span><br><span class="line"><span class="operator">&gt;</span> ZADD <span class="keyword">user</span>:xiaolin:ranking <span class="number">150</span> arcticle:<span class="number">5</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"></span><br><span class="line"># 文章 arcticle:<span class="number">4</span> 新增一个赞，可以使用 ZINCRBY 命令（为有序集合key中元素<span class="keyword">member</span>的分值加上increment）：</span><br><span class="line"><span class="operator">&gt;</span> ZINCRBY <span class="keyword">user</span>:xiaolin:ranking <span class="number">1</span> arcticle:<span class="number">4</span></span><br><span class="line">&quot;51&quot;</span><br><span class="line"></span><br><span class="line"># 查看某篇文章的赞数，可以使用 ZSCORE 命令（返回有序集合key中元素个数）：</span><br><span class="line"><span class="operator">&gt;</span> ZSCORE <span class="keyword">user</span>:xiaolin:ranking arcticle:<span class="number">4</span></span><br><span class="line">&quot;50&quot;</span><br><span class="line"></span><br><span class="line"># 获取小林文章赞数最多的 <span class="number">3</span> 篇文章，可以使用 ZREVRANGE 命令（倒序获取有序集合 key 从<span class="keyword">start</span>下标到stop下标的元素）：</span><br><span class="line"># WITHSCORES 表示把 score 也显示出来</span><br><span class="line"><span class="operator">&gt;</span> ZREVRANGE <span class="keyword">user</span>:xiaolin:ranking <span class="number">0</span> <span class="number">2</span> WITHSCORES</span><br><span class="line"><span class="number">1</span>) &quot;arcticle:1&quot;</span><br><span class="line"><span class="number">2</span>) &quot;200&quot;</span><br><span class="line"><span class="number">3</span>) &quot;arcticle:5&quot;</span><br><span class="line"><span class="number">4</span>) &quot;150&quot;</span><br><span class="line"><span class="number">5</span>) &quot;arcticle:3&quot;</span><br><span class="line"><span class="number">6</span>) &quot;100&quot;</span><br><span class="line"></span><br><span class="line"># 获取小林 <span class="number">100</span> 赞到 <span class="number">200</span> 赞的文章，可以使用 ZRANGEBYSCORE 命令（返回有序集合中指定分数区间内的成员，分数由低到高排序）：</span><br><span class="line"><span class="operator">&gt;</span> ZRANGEBYSCORE <span class="keyword">user</span>:xiaolin:ranking <span class="number">100</span> <span class="number">200</span> WITHSCORES</span><br><span class="line"><span class="number">1</span>) &quot;arcticle:3&quot;</span><br><span class="line"><span class="number">2</span>) &quot;100&quot;</span><br><span class="line"><span class="number">3</span>) &quot;arcticle:5&quot;</span><br><span class="line"><span class="number">4</span>) &quot;150&quot;</span><br><span class="line"><span class="number">5</span>) &quot;arcticle:1&quot;</span><br><span class="line"><span class="number">6</span>) &quot;200&quot;</span><br></pre></td></tr></table></figure>

<h3 id="电话、姓名排序"><a href="#电话、姓名排序" class="headerlink" title="电话、姓名排序"></a>电话、姓名排序</h3><p>使用有序集合的 ZRANGEBYLEX 或 ZREVRANGEBYLEX 可以帮助我们实现电话号码或姓名的排序</p>
<p>注意：不要在分数不一致的 SortSet 集合中去使用 ZRANGEBYLEX和 ZREVRANGEBYLEX 指令，因为获取的结果会不准确。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> ZADD phone <span class="number">0</span> <span class="number">13100111100</span> <span class="number">0</span> <span class="number">13110114300</span> <span class="number">0</span> <span class="number">13132110901</span> </span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"><span class="operator">&gt;</span> ZADD phone <span class="number">0</span> <span class="number">13200111100</span> <span class="number">0</span> <span class="number">13210414300</span> <span class="number">0</span> <span class="number">13252110901</span> </span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"><span class="operator">&gt;</span> ZADD phone <span class="number">0</span> <span class="number">13300111100</span> <span class="number">0</span> <span class="number">13310414300</span> <span class="number">0</span> <span class="number">13352110901</span> </span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"></span><br><span class="line"># 获取所有号码:</span><br><span class="line"><span class="number">1</span>) &quot;13100111100&quot;</span><br><span class="line"><span class="number">2</span>) &quot;13110114300&quot;</span><br><span class="line"><span class="number">3</span>) &quot;13132110901&quot;</span><br><span class="line"><span class="number">4</span>) &quot;13200111100&quot;</span><br><span class="line"><span class="number">5</span>) &quot;13210414300&quot;</span><br><span class="line"><span class="number">6</span>) &quot;13252110901&quot;</span><br><span class="line"><span class="number">7</span>) &quot;13300111100&quot;</span><br><span class="line"><span class="number">8</span>) &quot;13310414300&quot;</span><br><span class="line"><span class="number">9</span>) &quot;13352110901&quot;</span><br><span class="line"></span><br><span class="line"># 获取 <span class="number">132</span> 号段的号码：</span><br><span class="line"><span class="operator">&gt;</span> ZRANGEBYLEX phone [<span class="number">132</span> (<span class="number">133</span></span><br><span class="line"><span class="number">1</span>) &quot;13200111100&quot;</span><br><span class="line"><span class="number">2</span>) &quot;13210414300&quot;</span><br><span class="line"><span class="number">3</span>) &quot;13252110901&quot;</span><br><span class="line"></span><br><span class="line"># 获取<span class="number">132</span>、<span class="number">133</span>号段的号码：</span><br><span class="line"><span class="operator">&gt;</span> ZRANGEBYLEX phone [<span class="number">132</span> (<span class="number">134</span></span><br><span class="line"><span class="number">1</span>) &quot;13200111100&quot;</span><br><span class="line"><span class="number">2</span>) &quot;13210414300&quot;</span><br><span class="line"><span class="number">3</span>) &quot;13252110901&quot;</span><br><span class="line"><span class="number">4</span>) &quot;13300111100&quot;</span><br><span class="line"><span class="number">5</span>) &quot;13310414300&quot;</span><br><span class="line"><span class="number">6</span>) &quot;13352110901&quot;</span><br></pre></td></tr></table></figure>

<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a target="_blank" rel="noopener" href="https://xiaolincoding.com/redis/">图解Redis介绍</a><br><a target="_blank" rel="noopener" href="https://try.redis.io/">在线redis环境</a></p>

    </div>

    
    
    

    
      <div>
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:24px;">------------->本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

      </div>
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="jesonlin 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="jesonlin 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>原作者： </strong>jesonlin
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://jesonlin.com/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" title="redis-数据类型">https://jesonlin.com/存储/redis-数据类型/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/redis/" rel="tag"># redis</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%E5%AD%98%E5%82%A8/elasticsearch/" rel="prev" title="elasticsearch">
                  <i class="fa fa-chevron-left"></i> elasticsearch
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/%E5%AD%98%E5%82%A8/redis-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="next" title="redis-数据结构">
                  redis-数据结构 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2022 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jesonlin</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">238k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">3:37</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<!-- calendar widget -->

    <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-calendar/calendar.min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-calendar/languages.min.js"></script>
    <script>
    $(function() {
        $('#CloudCalendar').aCalendar('zh-CN',
            $.extend(
                '', {
                    single:true,
                    root:'/calendar/'
                }
            )
        );
    });
    </script>

<script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"linjinzhong","repo":"blog","client_id":"8548519d63363d8264e2","client_secret":"72867db898357c6f54e568137fb92545663b5c4a","admin_user":"linjinzhong","distraction_free_mode":true,"proxy":"https://strong-caramel-969805.netlify.app/github_access_token","language":"zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"59467b995e5acb7cecc9cc62fd2c12ee"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
